
<div id="TOC">
<ul>
<li><a href="#creating-my-own-theme">Creating my own theme</a></li>
<li><a href="#adding-text-to-barplots-with-position-dodge">Adding text to barplots with position = “dodge”</a></li>
<li><a href="#faceting-pie-charts-and-donut-plots">Faceting pie charts and donut plots</a></li>
<li><a href="#using-facet_grid-to-graph-multiple-groups-in-the-same-plot">Using facet_grid to graph multiple groups in the same plot</a></li>
<li><a href="#rotating-axis-text">Rotating axis text</a></li>
<li><a href="#heatmaps">Heatmaps</a></li>
<li><a href="#adding-a-benchmark-to-a-bar-graph">Adding a benchmark to a bar graph</a></li>
<li><a href="#unifying-legends">Unifying Legends</a></li>
</ul>
</div>

<p>Snippet files are periodically updated with how-to’s for better plotting techniques.</p>
<div id="creating-my-own-theme" class="section level1">
<h1>Creating my own theme</h1>
<p>I’ve borrowed heavily from the <code>hrbrthemes</code> and <code>myriad</code> packages to create a clean theme. Get it from github with the following…</p>
<pre class="r"><code>devtools::source_url(&quot;https://raw.githubusercontent.com/taylorgrant/sandbox/master/theme_twg.R&quot;)</code></pre>
</div>
<div id="adding-text-to-barplots-with-position-dodge" class="section level1">
<h1>Adding text to barplots with position = “dodge”</h1>
<p>With grouped bar charts <code>position = &quot;dodge&quot;</code> is used and the <code>geom_text</code> function also needs to be put into the same position. Note some other aesthetic changes here – <code>coord_flip()</code> was used and within that the limits of the y-axis were extended (this is because <code>coord_cartesian()</code> doesn’t work with the coordinates flipped). Within the <code>theme</code> section the title was centered, the axis labels were pushed to the edges and italicized, the caption font was altered. We also borrowed the <code>hrbrthemes</code> package function <code>scale_y_percent</code> to easily convert the axis to a percentage.</p>
<pre class="r"><code>tibble(type = rep(c(&#39;a&#39;,&#39;b&#39;), each = 4),
         cat = rep(c(&#39;cat&#39;, &#39;dog&#39;, &#39;bird&#39;, &#39;snake&#39;),2),
         n = sample(1:500, 8)) %&gt;%
  group_by(type) %&gt;%
  mutate(frac = n/sum(n)) %&gt;%
  ggplot(aes(x = cat, y = frac, group = type, 
             fill = type, label = scales::percent(frac))) + 
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) + 
  coord_flip(ylim = c(0,.6)) + 
  theme_twg() + 
  hrbrthemes::scale_y_percent() + 
  geom_text(aes(x = cat, y = frac+.04, 
                label = scales::percent(frac)),
            position = position_dodge(1),
            size = 3.5) +
  scale_fill_manual(values = c(&quot;#154577&quot;, &quot;#999999&quot;), name = &quot;&quot;) + 
  theme(legend.position = &quot;right&quot;,
              plot.title = element_text(hjust = .5),
              axis.title.x = element_text(hjust = 1, face = &quot;italic&quot;, size = 8),
              axis.title.y = element_text(hjust = 1, face = &#39;italic&#39;, size = 8),
              plot.caption = element_text(color = &quot;#303030&quot;, face = &quot;italic&quot;)) + 
  labs(x = &quot;Some Thing&quot;, y = &quot;Percent&quot;,
       title = &quot;Title of Graph&quot;,
       caption = &quot;Source: data source&quot;)</code></pre>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="faceting-pie-charts-and-donut-plots" class="section level1">
<h1>Faceting pie charts and donut plots</h1>
<p>Of course no one likes pie charts, but occasionally someone wants one. A single pie chart is simple to make in ggplot (see <a href="http://www.sthda.com/english/wiki/ggplot2-pie-chart-quick-start-guide-r-software-and-data-visualization" target="_blank">here</a>), but what if you want to facet your pie charts?</p>
<p>This was the old way of having to make pie charts with ggplot and it still works really well. Since we applied <code>theme_minimal()</code> (not sure it’s necessary in this case) to everything, we have to go back in and recolor the facet labels within the theme.</p>
<pre class="r"><code>tibble(type = rep(c(&#39;a&#39;,&#39;b&#39;, &#39;c&#39;), each = 4),
         cat = rep(c(&#39;cat&#39;, &#39;dog&#39;, &#39;bird&#39;, &#39;snake&#39;),3),
         n = sample(1:500, 12)) %&gt;%
  group_by(type) %&gt;%
  mutate(frac = n/sum(n),
         ymax = cumsum(frac),
         ymin = c(0, head(ymax, n = -1))) %&gt;%
  ggplot(aes(fill = factor(cat), ymax = ymax, ymin = ymin, 
             xmax = 8, xmin = 6)) +
  facet_wrap(~type, ncol = 3) + geom_rect(colour = &quot;white&quot;, show.legend = TRUE) +
  coord_polar(theta = &quot;y&quot;) + theme_minimal() + 
  scale_fill_manual(values = c(&quot;#154577&quot;, &quot;#999999&quot;, &#39;#fccd22&#39;,&#39;#0c725a&#39;),
                    labels = c(&quot;Cat&quot;, &quot;Dog&quot;, &#39;Bird&#39;, &quot;Snake&quot;),
                    name = &quot;&quot;) + 
  theme(legend.position = &quot;bottom&quot;,
        panel.grid=element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        plot.title = element_text(hjust = .5),
        strip.background =element_rect(fill=&quot;lightgray&quot;, color = NA)) + 
  labs(x = &quot;x-axis label&quot;, y = &quot;y-axis label&quot;,
       title = &quot;Title over a row of faceted pie charts&quot;)</code></pre>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Note that you can turn these pie charts into donut plots by adding <code>xlim(4,8)</code> within the code. The first number decides the thickness of the donut (larger = thicker); the second number dictates the size of the donut (smaller equals larger).</p>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="using-facet_grid-to-graph-multiple-groups-in-the-same-plot" class="section level1">
<h1>Using facet_grid to graph multiple groups in the same plot</h1>
<p>Sometimes you want to make a point about how certain factors are always larger or smaller than another across multiple groups. It can all be plotted out on the same graph, but it’s difficult to draw attention to the groupings - ggplot doesn’t add space between groups on its own. But if we facet by group, we can gain a little breathing room between each group. And by using <code>facet_grid</code> we can rotate the graph.</p>
<pre class="r"><code>tibble(group = c(&#39;Group A&#39;, &#39;Group A&#39;, 
                 &#39;Group B&#39;, &#39;Group B&#39;, 
                 &#39;Group C&#39;, &#39;Group C&#39;), 
       fctr = c(&#39;&lt; Threshold&#39;, &#39;&gt; Threshold&#39;,
                &#39;&lt; Age&#39;, &#39;&gt; Age&#39;,
                &#39;&lt; Count&#39;, &#39;&gt; Count&#39;),
       value = c(.2, .7, .4, .6, .35, .65)) %&gt;%
  mutate(order = c(1,2,1,2,1,2)) %&gt;%
  ggplot(aes(x = fctr, y = value, label = scales::percent(value), fill = factor(order))) + 
  geom_bar(stat = &quot;identity&quot;) + 
  facet_grid(group ~ ., scales = &quot;free_y&quot;) + 
  coord_flip(ylim = c(0, .8)) + 
  hrbrthemes::scale_y_percent() + 
  scale_fill_manual(values = c(&quot;#b6af06&quot;, &quot;#004d7c&quot;)) + 
  geom_text(nudge_y = .04) + 
  theme_twg() + 
  theme(legend.position = &#39;none&#39;,
        strip.background =element_rect(fill=&quot;lightgray&quot;, color = NA)) +
  labs(x = &quot;&quot;, y = &#39;Percent&#39;)</code></pre>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="rotating-axis-text" class="section level1">
<h1>Rotating axis text</h1>
<p>This graph looks terrible.</p>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>But we can do two things to make the graph work. Scale the dates being used in the axis with <code>scale_x_date</code> and rotate the label in the them.</p>
<pre class="r"><code>tibble(date = seq.Date(as.Date(&quot;2019-01-01&quot;), as.Date(&quot;2019-12-01&quot;), by = &quot;week&quot;),
       value = sample(1:100, 48)/100) %&gt;%
  ggplot(aes(x = date, y = value)) + 
  geom_line(col = &quot;dodgerblue&quot;) + 
  scale_x_date(date_breaks = &quot;2 weeks&quot;) + 
  theme_twg() + 
  hrbrthemes::scale_y_percent() +
  labs(x = &quot;&quot;, y= &quot;&quot;) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="heatmaps" class="section level1">
<h1>Heatmaps</h1>
<p>Heatmaps are simple to make. In this case, we have data at the monthly level with some missing data. Options are used within the fill command to ensure the lower and upper extremes aren’t too dark or light; <code>na.value</code> allows us to change the values of our NA months. Additionally, the plot margins are altered to give more room around the plot while leaving the left margin untouched to give it sense of width.</p>
<pre class="r"><code>library(viridis)
tibble(date = seq.Date(as.Date(&quot;2014-01-01&quot;), as.Date(&quot;2019-12-01&quot;), &quot;month&quot;),
       value = c(sample(10000:100000, 63), rep(NA_integer_, 9))) %&gt;% 
  mutate(month = lubridate::month(date, label = TRUE),
         year = factor(lubridate::year(date))) %&gt;%
  ggplot(aes(x = month, y = year, fill = value)) + 
  geom_tile(color = &quot;white&quot;) +
  scale_fill_viridis(option=&quot;magma&quot;, begin = .1, end = .9,
                     na.value = &quot;gray&quot;,
                     breaks = seq(20000, 100000, 20000),
                     labels = c(&quot;20k&quot;, &quot;40k&quot;, &quot;60k&quot;, &quot;80k&quot;, &quot;100k&quot;)) + 
  theme_twg() + 
  theme(legend.title = element_blank(),
        plot.margin=unit(c(1,1,1,0),&quot;cm&quot;)) +
  labs(x = &quot;&quot;, y = &quot;&quot;,
       title = &quot;This is a heatmap&quot;,
       caption = &quot;Using viridis color scales&quot;)</code></pre>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="adding-a-benchmark-to-a-bar-graph" class="section level1">
<h1>Adding a benchmark to a bar graph</h1>
<p>We’ll assume that each bar is a category with a separate benchmark and we’ll have different groups so we’ll also add in facets.</p>
<pre class="r"><code># build a dataset 
data &lt;- tibble(component = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, 
                             &quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;G&quot;),
               g1 = c(666, 652, 630, 588, 630, 575, 593),
               g2 = c(699, 674, 631, 521, 615, 544, 561), 
               g3 = c(486, 477,506, 509, 496, 447, 453),
               benchmark = c(622, 608,596,581,593,558,559))

# now graph 
data %&gt;% 
  gather(group, score, 2:4) %&gt;% 
  mutate(group = case_when(group == &quot;g1&quot; ~ &quot;Group 1&quot;,
                        group == &quot;g2&quot; ~ &quot;Group 2&quot;,
                        group == &quot;g3&quot; ~ &quot;Group 3&quot;),
         score2 = paste0(score, &quot; (&quot;, benchmark, &quot;)&quot;)) %&gt;%
  ggplot(aes(x = component, y = score, label = score2, fill = group)) + 
  geom_bar(stat = &quot;identity&quot;,alpha = .9) +
  facet_grid(group ~ .) + 
  coord_flip() + 
  ylim(c(0, 760)) +
  geom_text(aes(x = component, y = 739),
            size = 2.5) +
  scale_fill_manual(values = c(&quot;#3b5998&quot;, &quot;#8b9dc3&quot;,&quot;#dfe3ee&quot;),
                    # labels = c(&quot;All is Bright&quot;,
                    #            &#39;Jenni Mistletoe&#39;,
                    #            &quot;Most Wonderful\nSale of the Year&quot;),
                    name = &quot;&quot;) +
  geom_segment(aes(xend = component, yend = benchmark-2, y = benchmark+2), size = 5, lineend = &quot;butt&quot;,
               color = &quot;black&quot;) + 
  theme_twg() + 
  theme(strip.background = element_rect(fill=&quot;lightgray&quot;, color = NA),
        legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, y = &quot;Score&quot;,
       title = &quot;Component Scores for Each Group&quot;,
       caption = &quot;Note: Black lines are Benchmarks&quot;)</code></pre>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="unifying-legends" class="section level1">
<h1>Unifying Legends</h1>
<p>If you manually specify colors and add shapes in a scatterplot, two legends are created. You can unify them by naming them the same thing, or naming them both as <code>NULL</code>.</p>
<pre class="r"><code>library(patchwork)

p1 &lt;- ggplot(mtcars, aes(x = hp, y = mpg, group = factor(gear), col = factor(gear), shape = factor(gear) )) + 
  geom_point() + 
  scale_color_manual(name = &quot;Color&quot;, values = c(&quot;purple&quot;, &quot;green&quot;, &quot;navyblue&quot;)) +
  scale_shape_manual(name = &quot;Shapes&quot;, values = c(16, 15 ,14))

p2 &lt;- ggplot(mtcars, aes(x = hp, y = mpg, group = factor(gear), col = factor(gear), shape = factor(gear))) + 
  geom_point() + 
  scale_color_manual(name = NULL, values = c(&quot;purple&quot;, &quot;green&quot;, &quot;navyblue&quot;)) +
  scale_shape_manual(name = NULL, values = c(16, 15 ,14))

p1 | p2</code></pre>
<p><img src="2019-03-28-snippets-ggplot_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
